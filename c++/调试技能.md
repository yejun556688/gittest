

#### Linux段错误(core dumped)

Linux环境中当程序崩溃时，内核会把信息映射到**core**文件中。

1.使用core文件调试程序:

```c++
#include<stdio.h>
char* str = "test";
void core_test() {
  str[1] = 'T';
}

int main() {
  core_test();
  return 0;
}
```

编译：

```c++
gcc -g test.c -o test
```

gcc加上-g编译选项，这样调试core文件的时候比较容易找到错误的地方。 

执行：

```c++
./test
  段错误 (核心已转储)
```

运行test程序出现了“段错误”，但没有产生core文件。这是因为系统默认core文件的大小为0，所以没有创建。可以用ulimit命令查看和修改core文件的大小。 

```
ulimit -c 0 
ulimit -c 1000 
ulimit -c 1000 
```

`-c`指定修改core文件的大小，1000指定了core文件大小。也可以对core文件的大小不做限制，如： 

```
ulimit -c unlimited 
```

如果想让修改永久生效，则需要修改配置文件，如.bash_profile、/etc/profile或/etc/security/limits.conf。

再次执行： 

```
./test 
段错误 (核心已转储)
ls core*
```

调式core文件 , core文件是个二进制文件，需要用相应的工具来分析程序崩溃时的内存映像。在Linux下可以用GDB来调试core文件。

```
gdb test core
```

运行结果：

```
GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.5) 7.11.1
Copyright (C) 2016 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from a.out...done.
[New LWP 8828]
Core was generated by `./a.out'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x00000000004004e5 in core_test () at test.c:5

warning: Source file is more recent than executable.
5	  str[1] = 'T';
(gdb) where
#0  0x00000000004004e5 in core_test () at test.c:5
#1  0x00000000004004f9 in main () at test.c:10
(gdb) backtrace
#0  0x00000000004004e5 in core_test () at test.c:5
#1  0x00000000004004f9 in main () at test.c:10
(gdb) info stack
#0  0x00000000004004e5 in core_test () at test.c:5
#1  0x00000000004004f9 in main () at test.c:10
(gdb) 
```

GDB中键入`where`/`backtrace`/`info stack`，就会看到程序崩溃时堆栈信息。